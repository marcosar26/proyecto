import{a as le}from"./chunk-WRZOVP6N.js";import{a as X,b as v,c as Y,d as Z,e as ee,f as te,g as ne,h as ie,l as re,m as oe,n as ae,o as ce}from"./chunk-6W6VPMUT.js";import{e as Q}from"./chunk-723MAOPJ.js";import{$ as _,Ca as k,Ha as N,K as h,La as d,Ob as j,Pb as B,Qb as L,Ra as c,Sb as z,Ta as O,Vb as H,Wa as i,Wb as J,Xa as n,Xb as K,Ya as p,Za as P,_ as u,_a as y,a as M,ab as g,b as A,bb as f,cb as l,fb as U,g as T,kb as I,lb as r,mb as S,nb as C,ob as W,qb as $,rb as x,tb as D,ua as V,ub as E,vb as q,xa as a,xb as R,yb as G,zb as F}from"./chunk-CIQHODYI.js";var w=t=>({"is-invalid":t}),de=(t,o,e)=>({"bg-success":t,"bg-warning text-dark":o,"bg-danger":e}),se=()=>["/stock-movements"],pe=t=>({productId:t});function ue(t,o){if(t&1){let e=g();i(0,"button",11),f("click",function(){u(e);let s=l(2);return _(s.openNewProductForm())}),p(1,"i",12),r(2,"A\xF1adir Producto "),n()}}function _e(t,o){if(t&1){let e=g();i(0,"button",13),f("click",function(){u(e);let s=l(2);return _(s.cancelAndCloseForm())}),r(1),n()}if(t&2){let e=l(2);a(),C(" ",e.isEditing?"Cancelar Edici\xF3n":"Cancelar Nuevo Producto"," ")}}function fe(t,o){if(t&1&&(P(0),d(1,ue,3,0,"button",9)(2,_e,2,1,"button",10),y()),t&2){let e=l();a(),c("ngIf",!e.showForm),a(),c("ngIf",e.showForm)}}function ge(t,o){t&1&&(i(0,"div"),r(1,"El nombre es obligatorio."),n())}function ve(t,o){if(t&1&&(i(0,"div",39),d(1,ge,2,0,"div",5),n()),t&2){let e=l(2);a(),c("ngIf",e.name==null||e.name.errors==null?null:e.name.errors.required)}}function xe(t,o){t&1&&(i(0,"div"),r(1,"El precio es obligatorio."),n())}function be(t,o){t&1&&(i(0,"div"),r(1,"El precio debe ser mayor que 0."),n())}function he(t,o){if(t&1&&(i(0,"div",40),d(1,xe,2,0,"div",5)(2,be,2,0,"div",5),n()),t&2){let e=l(2);a(),c("ngIf",e.price==null||e.price.errors==null?null:e.price.errors.required),a(),c("ngIf",e.price==null||e.price.errors==null?null:e.price.errors.min)}}function ke(t,o){t&1&&(i(0,"div"),r(1,"El stock es obligatorio."),n())}function Se(t,o){t&1&&(i(0,"div"),r(1,"El stock no puede ser negativo."),n())}function Ce(t,o){if(t&1&&(i(0,"div",39),d(1,ke,2,0,"div",5)(2,Se,2,0,"div",5),n()),t&2){let e=l(2);a(),c("ngIf",e.stock==null||e.stock.errors==null?null:e.stock.errors.required),a(),c("ngIf",e.stock==null||e.stock.errors==null?null:e.stock.errors.min)}}function Ee(t,o){if(t&1){let e=g();i(0,"div",14)(1,"div",15)(2,"h3",16),r(3),n(),i(4,"form",17),f("ngSubmit",function(){u(e);let s=l();return _(s.onSubmit())}),i(5,"div",7)(6,"label",18),r(7,"Nombre del Producto:"),n(),p(8,"input",19),d(9,ve,2,1,"div",20),n(),i(10,"div",7)(11,"label",21),r(12,"Descripci\xF3n:"),n(),p(13,"textarea",22),i(14,"small",23),r(15,"Opcional. Breve descripci\xF3n del producto."),n()(),i(16,"div",24)(17,"div",25)(18,"label",26),r(19,"Precio:"),n(),i(20,"div",27)(21,"span",28),r(22,"$"),n(),p(23,"input",29),n(),d(24,he,3,2,"div",30),n(),i(25,"div",25)(26,"label",31),r(27,"Stock:"),n(),p(28,"input",32),d(29,Ce,3,2,"div",20),n()(),i(30,"div",7)(31,"label",33),r(32,"URL de la Imagen:"),n(),p(33,"input",34),i(34,"small",23),r(35,"Opcional. Pega la URL de una imagen para el producto."),n()(),i(36,"div",35)(37,"button",36),f("click",function(){u(e);let s=l();return _(s.cancelAndCloseForm())}),r(38,"Cancelar"),n(),i(39,"button",37),p(40,"i",38),r(41),n()()()()()}if(t&2){let e=l();a(3),S(e.isEditing?"Editar Producto":"A\xF1adir Nuevo Producto"),a(),c("formGroup",e.productForm),a(4),c("ngClass",x(10,w,(e.name==null?null:e.name.invalid)&&((e.name==null?null:e.name.dirty)||(e.name==null?null:e.name.touched)))),a(),c("ngIf",(e.name==null?null:e.name.invalid)&&((e.name==null?null:e.name.dirty)||(e.name==null?null:e.name.touched))),a(14),c("ngClass",x(12,w,(e.price==null?null:e.price.invalid)&&((e.price==null?null:e.price.dirty)||(e.price==null?null:e.price.touched)))),a(),c("ngIf",(e.price==null?null:e.price.invalid)&&((e.price==null?null:e.price.dirty)||(e.price==null?null:e.price.touched))),a(4),c("ngClass",x(14,w,(e.stock==null?null:e.stock.invalid)&&((e.stock==null?null:e.stock.dirty)||(e.stock==null?null:e.stock.touched)))),a(),c("ngIf",(e.stock==null?null:e.stock.invalid)&&((e.stock==null?null:e.stock.dirty)||(e.stock==null?null:e.stock.touched))),a(10),c("disabled",e.productForm.invalid),a(2),C("",e.isEditing?"Actualizar Producto":"Guardar Producto"," ")}}function Pe(t,o){t&1&&(i(0,"th",51),r(1,"Acciones"),n())}function ye(t,o){if(t&1){let e=g();i(0,"td",58)(1,"button",59),f("click",function(){u(e);let s=l().$implicit,b=l(3);return _(b.openEditProductForm(s))}),p(2,"i",60),n(),i(3,"button",61),f("click",function(){u(e);let s=l().$implicit,b=l(3);return _(b.deleteProduct(s.id))}),p(4,"i",62),n(),i(5,"a",63),p(6,"i",64),n()()}if(t&2){let e=l().$implicit;a(5),c("routerLink",$(2,se))("queryParams",x(3,pe,e.id))}}function Ie(t,o){if(t&1&&(i(0,"tr")(1,"td"),p(2,"img",52),n(),i(3,"td",53),r(4),n(),i(5,"td"),r(6),E(7,"slice"),n(),i(8,"td",54),r(9),E(10,"currency"),n(),i(11,"td",55)(12,"span",56),r(13),n()(),d(14,ye,7,5,"td",57),n()),t&2){let e=o.$implicit,m=l(3);O("table-danger",e.stock===0)("table-warning",e.stock>0&&e.stock<10),a(2),U("alt",e.name),c("src",e.imageUrl||"https://via.placeholder.com/60x60/dee2e6/6c757d?Text=N/A",V),a(2),S(e.name),a(2),W("",R(7,13,e.description||"-",0,50),"",e.description&&e.description.length>50?"...":"",""),a(3),S(G(10,17,e.price,"USD","symbol","1.2-2")),a(3),c("ngClass",D(22,de,e.stock>=10,e.stock>0&&e.stock<10,e.stock===0)),a(),C(" ",e.stock," "),a(),c("ngIf",m.canPerformWriteActions)}}function Fe(t,o){if(t&1&&(i(0,"div",42)(1,"table",43)(2,"thead",44)(3,"tr")(4,"th",45),r(5,"Imagen"),n(),i(6,"th",46),r(7,"Nombre"),n(),i(8,"th",46),r(9,"Descripci\xF3n"),n(),i(10,"th",47),r(11,"Precio"),n(),i(12,"th",48),r(13,"Stock"),n(),d(14,Pe,2,0,"th",49),n()(),i(15,"tbody"),d(16,Ie,15,26,"tr",50),n()()()),t&2){let e=l().ngIf,m=l();a(14),c("ngIf",m.canPerformWriteActions),a(2),c("ngForOf",e)}}function we(t,o){if(t&1&&(P(0),d(1,Fe,17,2,"div",41),y()),t&2){let e=o.ngIf;l();let m=I(13);a(),c("ngIf",e.length>0)("ngIfElse",m)}}function Me(t,o){t&1&&(i(0,"div",65)(1,"div",66)(2,"span",67),r(3,"Cargando productos..."),n()(),i(4,"p",68),r(5,"Cargando productos..."),n()())}function Ae(t,o){if(t&1){let e=g();i(0,"span"),r(1," Puedes "),i(2,"a",71),f("click",function(s){return u(e),l(2).openNewProductForm(),_(s.preventDefault())}),r(3,"a\xF1adir uno nuevo"),n(),r(4,"."),n()}}function Te(t,o){if(t&1&&(i(0,"div",69),p(1,"i",70),r(2,"No hay productos en el inventario. "),d(3,Ae,5,0,"span",5),n()),t&2){let e=l();a(3),c("ngIf",e.canPerformWriteActions)}}var me=class t{constructor(o,e,m){this.productService=o;this.fb=e;this.authService=m;this.userRole=this.authService.userRole,this.canPerformWriteActions=this.authService.hasRole(["admin","manager"]),this.products$=this.productService.getProducts(),this.productForm=this.fb.group({name:[{value:"",disabled:!this.canPerformWriteActions},v.required],description:[{value:"",disabled:!this.canPerformWriteActions}],price:[{value:null,disabled:!this.canPerformWriteActions},[v.required,v.min(.01)]],stock:[{value:null,disabled:!this.canPerformWriteActions},[v.required,v.min(0)]],imageUrl:[{value:"",disabled:!this.canPerformWriteActions}]})}products$;productForm;isEditing=!1;currentProductId=null;showForm=!1;userRole;canPerformWriteActions=!1;destroy$=new T;ngOnInit(){}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}openNewProductForm(){if(!this.canPerformWriteActions){console.warn("Acci\xF3n no permitida: Usuario no tiene permisos para a\xF1adir productos.");return}this.isEditing=!1,this.currentProductId=null,this.productForm.reset(),this.showForm=!0}openEditProductForm(o){if(!this.canPerformWriteActions){console.warn("Acci\xF3n no permitida: Usuario no tiene permisos para editar productos.");return}this.isEditing=!0,this.currentProductId=o.id,this.productForm.patchValue(o),this.showForm=!0}deleteProduct(o){if(!this.canPerformWriteActions){console.warn("Acci\xF3n no permitida: Usuario no tiene permisos para eliminar productos.");return}confirm("\xBFEst\xE1s seguro de que quieres eliminar este producto?")&&this.productService.deleteProduct(o).pipe(h(this.destroy$)).subscribe({next:()=>{console.log("Producto eliminado"),this.currentProductId===o&&this.cancelAndCloseForm()},error:e=>console.error("Error en la suscripci\xF3n de eliminaci\xF3n:",e)})}onSubmit(){if(!this.canPerformWriteActions){console.warn("Acci\xF3n no permitida: Usuario no tiene permisos para guardar productos.");return}if(this.productForm.invalid){this.productForm.markAllAsTouched();return}let o=this.productForm.getRawValue();this.isEditing&&this.currentProductId!==null?this.productService.updateProduct(A(M({},o),{id:this.currentProductId})).pipe(h(this.destroy$)).subscribe({next:e=>{console.log("Producto actualizado:",e),this.cancelAndCloseForm()},error:e=>console.error("Error al actualizar producto:",e)}):this.productService.addProduct(o).pipe(h(this.destroy$)).subscribe({next:e=>{console.log("Producto a\xF1adido:",e),this.cancelAndCloseForm()},error:e=>console.error("Error al a\xF1adir producto:",e)})}cancelAndCloseForm(){this.isEditing=!1,this.currentProductId=null,this.showForm=!1,this.productForm.reset()}get name(){return this.productForm.get("name")}get price(){return this.productForm.get("price")}get stock(){return this.productForm.get("stock")}static \u0275fac=function(e){return new(e||t)(k(le),k(oe),k(ce))};static \u0275cmp=N({type:t,selectors:[["app-stock-management"]],decls:14,vars:6,consts:[["loadingTemplate",""],["noProductsTemplate",""],[1,"container","mt-4","stock-container"],[1,"d-flex","justify-content-between","align-items-center","mb-4","page-header"],[1,"mb-0"],[4,"ngIf"],["class","card product-form mb-4 shadow-sm",4,"ngIf"],[1,"mb-3"],[4,"ngIf","ngIfElse"],["class","btn btn-primary",3,"click",4,"ngIf"],["class","btn btn-outline-secondary",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-plus","me-1"],[1,"btn","btn-outline-secondary",3,"click"],[1,"card","product-form","mb-4","shadow-sm"],[1,"card-body"],[1,"card-title","mb-3"],[3,"ngSubmit","formGroup"],["for","name",1,"form-label"],["type","text","id","name","formControlName","name",1,"form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["for","description",1,"form-label"],["id","description","formControlName","description","rows","3",1,"form-control"],[1,"form-text","text-muted"],[1,"row"],[1,"col-md-6","mb-3"],["for","price",1,"form-label"],[1,"input-group"],[1,"input-group-text"],["type","number","id","price","formControlName","price","step","0.01","min","0.01",1,"form-control",3,"ngClass"],["class","invalid-feedback d-block",4,"ngIf"],["for","stock",1,"form-label"],["type","number","id","stock","formControlName","stock","min","0",1,"form-control",3,"ngClass"],["for","imageUrl",1,"form-label"],["type","url","id","imageUrl","formControlName","imageUrl",1,"form-control"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-light","border","me-2",3,"click"],["type","submit",1,"btn","btn-success",3,"disabled"],[1,"fas","fa-save","me-1"],[1,"invalid-feedback"],[1,"invalid-feedback","d-block"],["class","table-responsive shadow-sm rounded",4,"ngIf","ngIfElse"],[1,"table-responsive","shadow-sm","rounded"],[1,"table","table-striped","table-hover","align-middle","mb-0"],[1,"table-dark"],["scope","col",2,"width","80px"],["scope","col"],["scope","col",1,"text-end"],["scope","col",1,"text-center",2,"width","100px"],["scope","col","class","text-center","style","width: 120px;",4,"ngIf"],[3,"table-danger","table-warning",4,"ngFor","ngForOf"],["scope","col",1,"text-center",2,"width","120px"],[1,"img-thumbnail","product-image-thumbnail",3,"src","alt"],[1,"fw-bold"],[1,"text-end"],[1,"text-center"],[1,"badge","fs-6",3,"ngClass"],["class","text-center action-buttons",4,"ngIf"],[1,"text-center","action-buttons"],["title","Editar Producto",1,"btn","btn-warning","btn-sm","me-2",3,"click"],[1,"fas","fa-pencil-alt"],["title","Eliminar Producto",1,"btn","btn-danger","btn-sm",3,"click"],[1,"fas","fa-trash-alt"],["title","Ver Historial del Producto",1,"btn","btn-sm","btn-outline-info",3,"routerLink","queryParams"],[1,"fas","fa-history"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],["role","alert",1,"alert","alert-info","mt-3"],[1,"fas","fa-info-circle","me-2"],["href","#",1,"alert-link",3,"click"]],template:function(e,m){if(e&1&&(i(0,"div",2)(1,"div",3)(2,"h2",4),r(3,"Gesti\xF3n de Stock de Productos"),n(),d(4,fe,3,2,"ng-container",5),n(),d(5,Ee,42,16,"div",6),i(6,"h3",7),r(7,"Listado de Productos"),n(),d(8,we,2,2,"ng-container",8),E(9,"async"),d(10,Me,6,0,"ng-template",null,0,F)(12,Te,4,1,"ng-template",null,1,F),n()),e&2){let s=I(11);a(4),c("ngIf",m.canPerformWriteActions),a(),c("ngIf",m.showForm&&m.canPerformWriteActions),a(3),c("ngIf",q(9,4,m.products$))("ngIfElse",s)}},dependencies:[K,j,B,L,z,J,H,ae,ee,X,te,Y,Z,re,ne,ie,Q],styles:[".page-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:300}.product-image-thumbnail[_ngcontent-%COMP%]{width:60px;height:60px;object-fit:cover}.invalid-feedback.d-block[_ngcontent-%COMP%]{display:block!important}.action-buttons[_ngcontent-%COMP%]   .btn-sm[_ngcontent-%COMP%]{padding:.2rem .45rem;line-height:1.2}.action-buttons[_ngcontent-%COMP%]   .btn-sm[_ngcontent-%COMP%]   .fas[_ngcontent-%COMP%]{font-size:.8em;vertical-align:-.05em}"]})};export{me as StockManagementComponent};
