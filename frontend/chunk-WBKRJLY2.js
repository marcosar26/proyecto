import{a as Q}from"./chunk-WRZOVP6N.js";import{b as B,e as U}from"./chunk-723MAOPJ.js";import{Ca as f,Ha as b,J as M,K as x,L as C,La as m,O as E,Ob as A,Pb as N,Qb as D,Ra as c,Sb as w,T as k,Tb as L,Ub as R,Wa as i,Xa as o,Xb as j,Za as P,_a as H,bc as F,cb as l,fc as q,g as h,kb as y,l as _,lb as r,m as I,mb as d,nb as v,ob as $,ub as u,vb as S,wb as T,xa as a,y as p,zb as O}from"./chunk-CIQHODYI.js";var g=class n{constructor(e){this.http=e}apiUrl=`${q.apiUrl}/stock-movements`;getAllMovements(){return this.http.get(this.apiUrl).pipe(p(this.handleError))}getMovementsByProductId(e){return this.http.get(`${this.apiUrl}/product/${e}`).pipe(p(this.handleError))}handleError(e){console.error("API Error (StockMovementService):",e);let t="Ocurri\xF3 un error con los movimientos de stock.";return e.error instanceof ErrorEvent?t=`Error: ${e.error.message}`:e.status===0?t="No se pudo conectar con el servidor. Verifique su conexi\xF3n o el estado del backend.":e.error&&typeof e.error=="string"?t=`Error ${e.status}: ${e.error}`:e.error&&e.error.message?t=`Error ${e.status}: ${e.error.message}`:t=`Error del servidor: ${e.status}, ${e.message}`,I(()=>new Error(t))}static \u0275fac=function(t){return new(t||n)(k(F))};static \u0275prov=E({token:n,factory:n.\u0275fac,providedIn:"root"})};function z(n,e){n&1&&(i(0,"h2"),r(1,"Historial de Movimientos de Stock"),o())}function K(n,e){if(n&1&&(i(0,"h2"),r(1),o()),n&2){let t=l();a(),v("Historial de Movimientos para: ",t.productName||"Producto ID: "+t.filterProductId,"")}}function W(n,e){n&1&&(i(0,"div",7)(1,"div",8)(2,"span",9),r(3,"Cargando historial..."),o()(),i(4,"p",10),r(5,"Cargando historial..."),o()())}function X(n,e){if(n&1&&(i(0,"div",11),r(1),o()),n&2){let t=l();a(),v(" ",t.errorMessage," ")}}function Y(n,e){n&1&&(i(0,"th",17),r(1,"Producto"),o())}function Z(n,e){if(n&1&&(i(0,"td"),r(1),o()),n&2){let t=l().$implicit;a(),$("",t.productName," (ID: ",t.productId,")")}}function ee(n,e){if(n&1&&(i(0,"tr")(1,"td"),r(2),u(3,"date"),o(),m(4,Z,2,2,"td",3),i(5,"td")(6,"span",21),r(7),u(8,"titlecase"),o()(),i(9,"td",22),r(10),o(),i(11,"td",23),r(12),o(),i(13,"td",23),r(14),o(),i(15,"td"),r(16),o(),i(17,"td"),r(18),o()()),n&2){let t=e.$implicit,s=l(4);a(2),d(T(3,10,t.movementDate,"dd/MM/yyyy HH:mm:ss")),a(2),c("ngIf",!s.filterProductId),a(2),c("ngClass",s.getMovementTypeClass(t.type)),a(),v(" ",S(8,13,t.type)," "),a(2),c("ngClass",s.getMovementTypeClass(t.type)),a(),v(" ",s.getQuantityDisplay(t)," "),a(2),d(t.stockBefore),a(2),d(t.stockAfter),a(2),d(t.reason||"-"),a(2),d(t.username||"N/A")}}function te(n,e){if(n&1&&(i(0,"div",14)(1,"table",15)(2,"thead",16)(3,"tr")(4,"th",17),r(5,"Fecha"),o(),m(6,Y,2,0,"th",18),i(7,"th",17),r(8,"Tipo"),o(),i(9,"th",19),r(10,"Cantidad Modificada"),o(),i(11,"th",19),r(12,"Stock Antes"),o(),i(13,"th",19),r(14,"Stock Despu\xE9s"),o(),i(15,"th",17),r(16,"Motivo"),o(),i(17,"th",17),r(18,"Usuario"),o()()(),i(19,"tbody"),m(20,ee,19,15,"tr",20),o()()()),n&2){let t=l().ngIf,s=l(2);a(6),c("ngIf",!s.filterProductId),a(14),c("ngForOf",t)}}function ne(n,e){if(n&1&&(i(0,"div"),m(1,te,21,2,"div",13),o()),n&2){let t=e.ngIf;l();let s=y(4);a(),c("ngIf",t.length>0)("ngIfElse",s)}}function ie(n,e){n&1&&(i(0,"span"),r(1," para este producto"),o())}function oe(n,e){if(n&1&&(i(0,"div",24),r(1," No hay movimientos de stock registrados "),m(2,ie,2,0,"span",3),r(3,". "),o()),n&2){let t=l(2);a(2),c("ngIf",t.filterProductId)}}function re(n,e){if(n&1&&(P(0),m(1,ne,2,2,"div",12),u(2,"async"),m(3,oe,4,1,"ng-template",null,0,O),H()),n&2){let t=y(4),s=l();a(),c("ngIf",S(2,2,s.movements$))("ngIfElse",t)}}var V=class n{constructor(e,t,s){this.stockMovementService=e;this.productService=t;this.route=s}movements$;isLoading=!1;errorMessage=null;filterProductId=null;productName=null;destroy$=new h;ngOnInit(){this.route.queryParamMap.pipe(x(this.destroy$),C(e=>{this.isLoading=!0,this.errorMessage=null,this.productName=null;let t=e.get("productId");this.filterProductId=t?+t:null}),M(()=>this.filterProductId!==null?(this.productService.getProductById(this.filterProductId).pipe(x(this.destroy$)).subscribe(e=>this.productName=e?.name||null),this.stockMovementService.getMovementsByProductId(this.filterProductId)):this.stockMovementService.getAllMovements()),p(e=>(this.errorMessage=e.message||"Error al cargar el historial de movimientos.",this.isLoading=!1,_([])))).subscribe({next:e=>{this.movements$=_(e),this.isLoading=!1}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}getMovementTypeClass(e){switch(e){case"ENTRADA":return"text-success";case"AJUSTE_INICIAL":return"text-primary";case"SALIDA":return"text-danger";case"CORRECCION":return"text-warning";default:return""}}getQuantityDisplay(e){return e.type==="SALIDA"||e.type==="CORRECCION"&&e.quantityChanged<0?`-${Math.abs(e.quantityChanged)}`:`+${e.quantityChanged}`}static \u0275fac=function(t){return new(t||n)(f(g),f(Q),f(B))};static \u0275cmp=b({type:n,selectors:[["app-stock-movements-history"]],decls:9,vars:5,consts:[["noMovements",""],[1,"container","mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[4,"ngIf"],["routerLink","/stock",1,"btn","btn-outline-secondary"],["class","text-center py-5",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],["role","alert",1,"alert","alert-danger"],[4,"ngIf","ngIfElse"],["class","table-responsive shadow-sm rounded",4,"ngIf","ngIfElse"],[1,"table-responsive","shadow-sm","rounded"],[1,"table","table-striped","table-hover","align-middle"],[1,"table-dark"],["scope","col"],["scope","col",4,"ngIf"],["scope","col",1,"text-center"],[4,"ngFor","ngForOf"],[1,"fw-bold",3,"ngClass"],[1,"text-center","fw-bold",3,"ngClass"],[1,"text-center"],["role","alert",1,"alert","alert-info","mt-3"]],template:function(t,s){t&1&&(i(0,"div",1)(1,"div",2),m(2,z,2,0,"h2",3)(3,K,2,1,"h2",3),i(4,"a",4),r(5,"Volver a Gesti\xF3n de Stock"),o()(),m(6,W,6,0,"div",5)(7,X,2,1,"div",6)(8,re,5,4,"ng-container",3),o()),t&2&&(a(2),c("ngIf",!s.filterProductId),a(),c("ngIf",s.filterProductId),a(3),c("ngIf",s.isLoading),a(),c("ngIf",s.errorMessage&&!s.isLoading),a(),c("ngIf",!s.isLoading&&!s.errorMessage))},dependencies:[j,A,N,D,w,L,R,U],encapsulation:2})};export{V as StockMovementsHistoryComponent};
