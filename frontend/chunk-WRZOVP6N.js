import{L as i,O as d,T as a,bc as p,fc as l,h as n,m as c,y as o}from"./chunk-CIQHODYI.js";var h=class s{constructor(r){this.http=r;this.loadInitialProducts()}apiUrl=`${l.apiUrl}/products`;productsSubject=new n([]);products$=this.productsSubject.asObservable();loadInitialProducts(){this.http.get(this.apiUrl).pipe(i(r=>this.productsSubject.next(r)),o(this.handleError)).subscribe({error:r=>console.error("Error cargando productos iniciales:",r)})}refreshProducts(){return this.http.get(this.apiUrl).pipe(i(r=>{this.productsSubject.next(r)}),o(this.handleError))}getProducts(){return this.products$}getProductById(r){return this.http.get(`${this.apiUrl}/${r}`).pipe(o(this.handleError))}addProduct(r){return this.http.post(this.apiUrl,r).pipe(i(t=>{let e=this.productsSubject.value;this.productsSubject.next([...e,t])}),o(this.handleError))}updateProduct(r){return r.id===void 0||r.id===null?c(()=>new Error("El ID del producto es necesario para actualizar.")):this.http.put(`${this.apiUrl}/${r.id}`,r).pipe(i(t=>{let e=this.productsSubject.value,u=e.findIndex(b=>b.id===t.id);u>-1&&(e[u]=t,this.productsSubject.next([...e]))}),o(this.handleError))}deleteProduct(r){return this.http.delete(`${this.apiUrl}/${r}`).pipe(i(()=>{let t=this.productsSubject.value;this.productsSubject.next(t.filter(e=>e.id!==r))}),o(this.handleError))}handleError(r){console.error("API Error:",r);let t="Ocurri\xF3 un error desconocido.";return r.error instanceof ErrorEvent?t=`Error: ${r.error.message}`:r.status===0?t="No se pudo conectar con el servidor. Verifique su conexi\xF3n o el estado del backend.":r.error&&typeof r.error=="string"?t=`Error ${r.status}: ${r.error}`:r.error&&r.error.message?t=`Error ${r.status}: ${r.error.message}`:t=`Error del servidor: ${r.status}, ${r.message}`,c(()=>new Error(t))}static \u0275fac=function(t){return new(t||s)(a(p))};static \u0275prov=d({token:s,factory:s.\u0275fac,providedIn:"root"})};export{h as a};
